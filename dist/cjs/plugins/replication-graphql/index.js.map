{"version":3,"file":"index.js","names":["_index","require","_helper","Object","keys","forEach","key","prototype","hasOwnProperty","call","_exportNames","exports","defineProperty","enumerable","get","_index2","_index3","_index4","_graphqlWebsocket","_rxjs","_graphqlSchemaFromRxSchema","_queryBuilderFromRxSchema","RxGraphQLReplicationState","_RxReplicationState","url","clientState","replicationIdentifier","collection","deletedField","pull","push","live","retryTime","autoStart","toggleOnDocumentVisible","customFetch","_this","_inheritsLoose2","default","_proto","setHeaders","headers","flatClone","setCredentials","credentials","graphQLRequest","queryParams","fetch","ensureNotFalsy","http","RxReplicationState","replicateGraphQL","waitForLeadership","addRxPlugin","RxDBLeaderElectionPlugin","mutateableClientState","pullStream$","Subject","replicationPrimitivesPull","pullBatchSize","batchSize","handler","lastPulledCheckpoint","pullGraphQL","queryBuilder","result","graphqlReplicationState","errors","data","getDataFromResult","dataPath","responseModifier","docsData","documents","newCheckpoint","checkpoint","modifier","stream$","asObservable","replicationPrimitivesPush","rows","pushObj","mustUseSocket","ws","streamQueryBuilder","startBefore","start","bind","httpHeaders","includeWsHeaders","undefined","wsClient","getGraphQLWebSocket","wsOptions","on","next","query","subscribe","streamResponse","firstField","error","complete","cancelBefore","cancel","isStopped","removeGraphQLWebSocketRef","startReplicationOnLeaderShip"],"sources":["../../../../src/plugins/replication-graphql/index.ts"],"sourcesContent":["/**\n * this plugin adds the RxCollection.syncGraphQl()-function to rxdb\n * you can use it to sync collections with a remote graphql endpoint.\n */\nimport {\n    ensureNotFalsy,\n    flatClone\n} from '../../plugins/utils/index.ts';\n\nimport {\n    getDataFromResult,\n    graphQLRequest\n} from './helper.ts';\n\nimport { RxDBLeaderElectionPlugin } from '../leader-election/index.ts';\nimport type {\n    RxCollection,\n    ReplicationPullOptions,\n    ReplicationPushOptions,\n    RxReplicationWriteToMasterRow,\n    GraphQLServerUrl,\n    RxReplicationPullStreamItem,\n    RxGraphQLReplicationQueryBuilderResponseObject,\n    RxGraphQLReplicationClientState,\n    ById\n} from '../../types/index.d.ts';\nimport {\n    RxReplicationState,\n    startReplicationOnLeaderShip\n} from '../replication/index.ts';\nimport {\n    addRxPlugin,\n    SyncOptionsGraphQL,\n    WithDeleted\n} from '../../index.ts';\n\nimport {\n    removeGraphQLWebSocketRef,\n    getGraphQLWebSocket\n} from './graphql-websocket.ts';\nimport { Subject } from 'rxjs';\n\n\nexport class RxGraphQLReplicationState<RxDocType, CheckpointType> extends RxReplicationState<RxDocType, CheckpointType> {\n    constructor(\n        public readonly url: GraphQLServerUrl,\n        public readonly clientState: RxGraphQLReplicationClientState,\n        public readonly replicationIdentifier: string,\n        public readonly collection: RxCollection<RxDocType, any, any, any>,\n        public readonly deletedField: string,\n        public readonly pull?: ReplicationPullOptions<RxDocType, CheckpointType>,\n        public readonly push?: ReplicationPushOptions<RxDocType>,\n        public readonly live?: boolean,\n        public retryTime?: number,\n        public autoStart?: boolean,\n        public toggleOnDocumentVisible?: boolean,\n        public readonly customFetch?: WindowOrWorkerGlobalScope['fetch'],\n    ) {\n        super(\n            replicationIdentifier,\n            collection,\n            deletedField,\n            pull,\n            push,\n            live,\n            retryTime,\n            autoStart,\n            toggleOnDocumentVisible\n        );\n    }\n\n    setHeaders(headers: ById<string>): void {\n        this.clientState.headers = flatClone(headers);\n    }\n\n    setCredentials(credentials: RequestCredentials | undefined) {\n        this.clientState.credentials = credentials;\n    }\n\n    graphQLRequest(\n        queryParams: RxGraphQLReplicationQueryBuilderResponseObject\n    ) {\n        return graphQLRequest(\n            this.customFetch ?? fetch,\n            ensureNotFalsy(this.url.http),\n            this.clientState,\n            queryParams\n        );\n    }\n}\n\nexport function replicateGraphQL<RxDocType, CheckpointType>(\n    {\n        collection,\n        url,\n        headers = {},\n        credentials,\n        deletedField = '_deleted',\n        waitForLeadership = true,\n        pull,\n        push,\n        live = true,\n        fetch: customFetch,\n        retryTime = 1000 * 5, // in ms\n        autoStart = true,\n        replicationIdentifier,\n        toggleOnDocumentVisible\n    }: SyncOptionsGraphQL<RxDocType, CheckpointType>\n): RxGraphQLReplicationState<RxDocType, CheckpointType> {\n    addRxPlugin(RxDBLeaderElectionPlugin);\n    /**\n     * We use this object to store the GraphQL client\n     * so we can later swap out the client inside of the replication handlers.\n     */\n    const mutateableClientState = {\n        headers,\n        credentials\n    };\n\n\n    const pullStream$: Subject<RxReplicationPullStreamItem<RxDocType, CheckpointType>> = new Subject();\n\n    let replicationPrimitivesPull: ReplicationPullOptions<RxDocType, CheckpointType> | undefined;\n    if (pull) {\n        const pullBatchSize = pull.batchSize ? pull.batchSize : 20;\n        replicationPrimitivesPull = {\n            async handler(\n                lastPulledCheckpoint: CheckpointType | undefined\n            ) {\n                const pullGraphQL = await pull.queryBuilder(lastPulledCheckpoint, pullBatchSize);\n                const result = await graphqlReplicationState.graphQLRequest(pullGraphQL);\n                if (result.errors) {\n                    throw result.errors;\n                }\n                let data: any = getDataFromResult(result, pull.dataPath);\n                if (pull.responseModifier) {\n                    data = await pull.responseModifier(\n                        data,\n                        'handler',\n                        lastPulledCheckpoint\n                    );\n                }\n\n                const docsData: WithDeleted<RxDocType>[] = data.documents;\n                const newCheckpoint = data.checkpoint;\n\n                return {\n                    documents: docsData,\n                    checkpoint: newCheckpoint\n                };\n            },\n            batchSize: pull.batchSize,\n            modifier: pull.modifier,\n            stream$: pullStream$.asObservable()\n        };\n    }\n    let replicationPrimitivesPush: ReplicationPushOptions<RxDocType> | undefined;\n    if (push) {\n        replicationPrimitivesPush = {\n            async handler(\n                rows: RxReplicationWriteToMasterRow<RxDocType>[]\n            ) {\n                const pushObj = await push.queryBuilder(rows);\n                const result = await graphqlReplicationState.graphQLRequest(pushObj);\n\n                if (result.errors) {\n                    throw result.errors;\n                }\n                let data: any = getDataFromResult(result, push.dataPath);\n                if (push.responseModifier) {\n                    data = await push.responseModifier(\n                        data,\n                    );\n                }\n\n                return data;\n            },\n            batchSize: push.batchSize,\n            modifier: push.modifier\n        };\n    }\n\n    const graphqlReplicationState = new RxGraphQLReplicationState(\n        url,\n        mutateableClientState,\n        replicationIdentifier,\n        collection,\n        deletedField,\n        replicationPrimitivesPull,\n        replicationPrimitivesPush,\n        live,\n        retryTime,\n        autoStart,\n        toggleOnDocumentVisible,\n        customFetch\n    );\n\n    const mustUseSocket = url.ws &&\n        pull &&\n        pull.streamQueryBuilder &&\n        live;\n\n    const startBefore = graphqlReplicationState.start.bind(graphqlReplicationState);\n    graphqlReplicationState.start = () => {\n        if (mustUseSocket) {\n            const httpHeaders = pull.includeWsHeaders ? mutateableClientState.headers : undefined;\n            const wsClient = getGraphQLWebSocket(ensureNotFalsy(url.ws), httpHeaders, pull.wsOptions);\n\n            wsClient.on('connected', () => {\n                pullStream$.next('RESYNC');\n            });\n\n            const query: any = ensureNotFalsy(pull.streamQueryBuilder)(mutateableClientState.headers);\n\n            wsClient.subscribe(\n                query,\n                {\n                    next: async (streamResponse: any) => {\n                        const firstField = Object.keys(streamResponse.data)[0];\n                        let data = streamResponse.data[firstField];\n                        if (pull.responseModifier) {\n                            data = await pull.responseModifier(\n                                data,\n                                'stream'\n                            );\n                        }\n                        pullStream$.next(data);\n                    },\n                    error: (error: any) => {\n                        pullStream$.error(error);\n                    },\n                    complete: () => {\n                        pullStream$.complete();\n                    }\n                });\n        }\n        return startBefore();\n    };\n\n    const cancelBefore = graphqlReplicationState.cancel.bind(graphqlReplicationState);\n    graphqlReplicationState.cancel = () => {\n        if (!graphqlReplicationState.isStopped()) {\n            pullStream$.complete();\n            if (mustUseSocket) {\n                removeGraphQLWebSocketRef(ensureNotFalsy(url.ws));\n            }\n        }\n        return cancelBefore();\n    };\n\n    startReplicationOnLeaderShip(waitForLeadership, graphqlReplicationState);\n    return graphqlReplicationState;\n}\n\nexport * from './helper.ts';\nexport * from './graphql-schema-from-rx-schema.ts';\nexport * from './query-builder-from-rx-schema.ts';\nexport * from './graphql-websocket.ts';\n\n"],"mappings":"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","ignoreList":[]}